C51 COMPILER V9.01   MAIN                                                                  04/24/2021 22:29:49 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<reg52.h>
   2          #include<intrins.h>
   3          
   4          sbit chen=P2^0;    //÷∏Œ∆≥…π¶µ∆
   5          sbit shi=P2^1;     //÷∏Œ∆ ß∞‹µ∆
   6          sbit Irfet_led=P2^3;    //∫ÏÕ‚÷∏ æµ∆
   7          sbit led=P2^5;     //≥ı ºªØµ∆
   8          sbit pressed=P2^6;  //∏–”¶ºÏ≤‚
   9          sbit PWM = P2^7;  //…Ë∂®PWM ‰≥ˆµƒI/O∂Àø⁄
  10          sbit K1=P3^1; 
  11          sbit GND=P1^1;     //∂Êª˙Ω”µÿ
  12          sbit IRIN=P3^2; //∫ÏÕ‚∂®“Â
  13          unsigned char count = 0;
  14          unsigned char timer1;
  15          unsigned int Irfet;     //∫ÏÕ‚Ω” ’’˝»∑¬ﬂº≠◊¥Ã¨,0Œ™false/1Œ™true;
  16          typedef unsigned int u16;         //∂‘ ˝æ›¿‡–ÕΩ¯––…˘√˜∂®“Â typedef
  17          typedef unsigned char u8;
  18          u8 IrValue[6];
  19          u8 Time;
  20          
  21          
  22          //////////////////////////////////////////////////////////////////////////
  23          volatile unsigned char FPM10A_RECEICE_BUFFER[32];        //∂®“ÂΩ” ’ª∫¥Ê«¯
  24          code unsigned char FPM10A_Pack_Head[6] = {0xEF,0x01,0xFF,0xFF,0xFF,0xFF};  //–≠“È∞¸Õ∑
  25          code unsigned char FPM10A_Get_Img[6] = {0x01,0x00,0x03,0x01,0x00,0x05};    //ªÒµ√÷∏Œ∆ÕºœÒ
  26          code unsigned char FPM10A_Img_To_Buffer1[7]={0x01,0x00,0x04,0x02,0x01,0x00,0x08}; //Ω´ÕºœÒ∑≈»ÎµΩBUFFER1
  27          code unsigned char FPM10A_Search[11]={0x01,0x00,0x08,0x04,0x01,0x00,0x00,0x00,0x64,0x00,0x72}; //À—À˜÷∏Œ∆À
             -—À˜∑∂Œß0 - 999, π”√BUFFER1÷–µƒÃÿ’˜¬ÎÀ—À˜
  28          //////////////////////////////////////////////////////////////////////////
  29          
  30          /************/
  31          
  32          /////////////////////////////////////////////
  33          //                 ∂® ±                    //               
  34          /////////////////////////////////////////////
  35          void delay1s(void)   //∂® ±1S,æß’Ò11.0592MHZ
  36          {
  37   1          unsigned char a,b,c;
  38   1          for(c=13;c>0;c--)
  39   1              for(b=247;b>0;b--)
  40   1                  for(a=142;a>0;a--);
  41   1          _nop_();  //if Keil,require use intrins.h
  42   1      }
  43          
  44          void delay100ms(void)   //∂® ±100MS,æß’Ò11.0592MHZ
  45          {
  46   1          unsigned char a,b;
  47   1          for(b=221;b>0;b--)
  48   1              for(a=207;a>0;a--);
  49   1      }
  50          
  51          
  52          void delay500ms(void)   //500ms
  53          {
  54   1          unsigned char a,b,c;
C51 COMPILER V9.01   MAIN                                                                  04/24/2021 22:29:49 PAGE 2   

  55   1          for(c=98;c>0;c--)
  56   1              for(b=127;b>0;b--)
  57   1                  for(a=17;a>0;a--);
  58   1          _nop_();
  59   1      }
  60          
  61          void delay1_6_f(void)   //ŒÛ≤Ó 0us
  62          {
  63   1          unsigned char a,b,c;
  64   1          for(c=218;c>0;c--)
  65   1              for(b=131;b>0;b--)
  66   1                  for(a=23;a>0;a--);
  67   1          _nop_();  //if Keil,require use intrins.h
  68   1      }
  69          
  70          void delay50ms(void)   //ŒÛ≤Ó 0us
  71          {
  72   1          unsigned char a,b;
  73   1          for(b=173;b>0;b--)
  74   1              for(a=143;a>0;a--);
  75   1      }
  76          
  77          void delay10ms(void)   //ŒÛ≤Ó 0us
  78          {
  79   1          unsigned char a,b,c;
  80   1          for(c=1;c>0;c--)
  81   1              for(b=38;b>0;b--)
  82   1                  for(a=130;a>0;a--);
  83   1      }
  84          
  85          void delay1ms(unsigned int i)
  86          {
  87   1         unsigned int k,j;
  88   1         for(k=0;k<i;k++)
  89   1            for(j=0;j<121;j++);
  90   1      }
  91          
  92          /********∫ÏÕ‚—” ±**********/
  93          void delay_Ir(u16 i)    //∫ÏÕ‚—” ±i=1‘º10us
  94          {
  95   1              while(i--);     
  96   1      }
  97          
  98          ///////////////////////////////////
  99          //             ∂Êª˙◊™∂Ø          //
 100          ///////////////////////////////////
 101          /*∂® ±∆˜T0≥ı ºªØ*/
 102          void Timer0_Init()           
 103          {
 104   1          TMOD &= 0x00;
 105   1          TMOD |= 0x01; //∂® ±∆˜T0…Ë÷√≥…∑Ω Ω1
 106   1       
 107   1          TH0 = 0xff;   //∂® ±≥£ ˝ 0.1ms æß’ÒŒ™11.0592MHz
 108   1          TL0 = 0xa4;
 109   1       
 110   1          ET0 = 1;      
 111   1          TR0 = 1; 
 112   1              EA=1; 
 113   1      }
 114                  
 115          /*T0÷–∂œ≥ı ºªØ*/
 116          void Time0_Init() interrupt 1 
C51 COMPILER V9.01   MAIN                                                                  04/24/2021 22:29:49 PAGE 3   

 117          {
 118   1              TR0 = 0; 
 119   1              TH0 = 0xff; // 0.1ms
 120   1              TL0 = 0xa4;
 121   1              
 122   1              if(count <= timer1) //timer1£∫5==0°„ 15==90°„
 123   1              { 
 124   2                      PWM = 1; 
 125   2              }
 126   1              else 
 127   1              { 
 128   2                      PWM = 0; 
 129   2              }
 130   1              count++;
 131   1              if (count >= 200        ) //T = 20ms«Â¡„
 132   1              { 
 133   2                      count = 0; 
 134   2              }
 135   1              TR0 = 1; //ø™∆ÙT0
 136   1      }
 137          
 138          ///////////////////////////////////
 139          /*÷∏Œ∆≥ı ºªØ*/
 140          void Uart_Init(void) //≥ı ºªØ
 141          {
 142   1          SCON=0x50;   //UART∑Ω Ω1:8ŒªUART;   REN=1:‘ –ÌΩ” ’
 143   1          PCON=0x00;   //SMOD=0:≤®Ãÿ¬ ≤ªº”±∂
 144   1          TMOD=0x20;   //T1∑Ω Ω2,”√”⁄UART≤®Ãÿ¬ 
 145   1          TH1=0xFD;          //UART≤®Ãÿ¬ …Ë÷√:FDFD(9600)
 146   1          TL1=0xFD;   //UART≤®Ãÿ¬ …Ë÷√:FDFD(9600)
 147   1          TR1=1;         //‘ –ÌT1º∆ ˝
 148   1          EA=1;         //
 149   1      }
 150          ///////////////////////////////////
 151          
 152          /*∫ÏÕ‚≥ı ºªØ*/
 153          void IrInit()
 154          {
 155   1              IT0=1;  //œ¬Ωµ—ÿ¥•∑¢
 156   1              EX0=1;  //¥Úø™÷–∂œ0‘ –Ì
 157   1              EA=1;   //¥Úø™◊‹÷–∂œ
 158   1              IRIN=1; //≥ı ºªØ∂Àø⁄
 159   1      }
 160          
 161          /*
 162          *UART∑¢ÀÕ∫ÕΩ” ’≤ø∑÷
 163          */
 164          
 165          void Uart_Send_Byte(unsigned char c)//uart∑¢ÀÕ“ª∏ˆ◊÷Ω⁄
 166          {
 167   1              SBUF = c;
 168   1              while(!TI);                //∑¢ÀÕÕÍŒ™1
 169   1              TI = 0;
 170   1      }
 171          
 172          unsigned char Uart_Receive_Byte()//UARTΩ” ‹“ª∏ˆ◊÷Ω⁄
 173          {       
 174   1              unsigned char dat;
 175   1              while(!RI);         //Ω” ’ÕÍŒ™1
 176   1              RI = 0;
 177   1              dat = SBUF;
 178   1              return (dat);
C51 COMPILER V9.01   MAIN                                                                  04/24/2021 22:29:49 PAGE 4   

 179   1      }
 180          
 181          
 182          
 183          ////////////////////////////////////////////
 184          //         AS608/FPM10A÷∏Œ∆ƒ£øÈ√¸¡Ó       //
 185          ////////////////////////////////////////////
 186          
 187          void FPM10A_Cmd_Send_Pack_Head(void)   //∑¢ÀÕÕ®—∂–≠“È∞¸Õ∑
 188          {
 189   1              int i;       
 190   1              for(i=0;i<6;i++)
 191   1         {
 192   2                      Uart_Send_Byte(FPM10A_Pack_Head[i]);   
 193   2         }               
 194   1      }
 195          
 196          void FPM10A_Receive_Data(unsigned char ucLength) //Ω” ’÷∏Œ∆ƒ£øÈ∑¥¿° ˝æ›ª∫≥Â
 197          {
 198   1        unsigned char i;
 199   1      
 200   1        for (i=0;i<ucLength;i++)
 201   1           FPM10A_RECEICE_BUFFER[i] = Uart_Receive_Byte();
 202   1      
 203   1      }
 204          
 205          void FPM10A_Cmd_Get_Img(void)                ////FINGERPRINT_ªÒµ√÷∏Œ∆ÕºœÒ√¸¡Ó(ºÏ≤‚ «∑Ò”–÷∏Œ∆)
 206          {
 207   1          unsigned char i;
 208   1          FPM10A_Cmd_Send_Pack_Head(); //∑¢ÀÕÕ®–≈–≠“È∞¸Õ∑
 209   1          for(i=0;i<6;i++)
 210   1              {
 211   2             Uart_Send_Byte(FPM10A_Get_Img[i]);
 212   2              }
 213   1      }
 214          //Ω≤ÕºœÒ◊™ªª≥…Ãÿ’˜¬Î¥Ê∑≈‘⁄Buffer1÷–
 215          void FINGERPRINT_Cmd_Img_To_Buffer1(void)
 216          {
 217   1              unsigned char i;
 218   1              FPM10A_Cmd_Send_Pack_Head(); //∑¢ÀÕÕ®–≈–≠“È∞¸Õ∑      
 219   1                 for(i=0;i<7;i++)   //∑¢ÀÕ√¸¡Ó Ω´ÕºœÒ◊™ªª≥… Ãÿ’˜¬Î ¥Ê∑≈‘⁄ CHAR_buffer1
 220   1           {
 221   2                   Uart_Send_Byte(FPM10A_Img_To_Buffer1[i]);                  
 222   2                  }
 223   1      }
 224          
 225          //À—À˜÷∏Œ∆ø‚«∞100√∂(ø…“‘◊‘º∫∏ƒDATA«¯µƒ ˝◊÷ ◊Ó∏ﬂ999∏ˆ)
 226          void FPM10A_Cmd_Search_Finger(void)
 227          {
 228   1             unsigned char i;                       
 229   1             FPM10A_Cmd_Send_Pack_Head(); //∑¢ÀÕÕ®–≈–≠“È∞¸Õ∑
 230   1             for(i=0;i<11;i++)
 231   1                 {
 232   2                        Uart_Send_Byte(FPM10A_Search[i]);    //Ω” ’÷∏Œ∆ƒ£øÈ∑¢ªÿµƒ ˝æ›
 233   2                            }
 234   1      }
 235          
 236          //À—À˜ «∑Ò”–÷∏Œ∆,»Ù”–‘Ú»œ÷§
 237          void FPM10A_Find_Fingerprint()
 238          {
 239   1        FPM10A_Cmd_Get_Img();                                         //∑¢ÀÕªÒµ√÷∏Œ∆ÕºœÒ√¸¡Ó
 240   1        FPM10A_Receive_Data(12);                                  //Ω” ’∑¥¿° ˝æ›ª∫≥Â
C51 COMPILER V9.01   MAIN                                                                  04/24/2021 22:29:49 PAGE 5   

 241   1        if(FPM10A_RECEICE_BUFFER[9]==0)                 //∏˘æ›∑¥¿°ªÿ¿¥µƒµ⁄9Œª ˝æ›¿¥≈–∂œƒ£øÈ…œ”–Œﬁ÷∏Œ∆£¨”–‘ÚºÃ–¯÷
             -¥––Œﬁ‘ÚÕÀ≥ˆ
 242   1        {
 243   2          delay100ms();
 244   2          FINGERPRINT_Cmd_Img_To_Buffer1();          //Ω≤ÕºœÒ◊™ªª≥…Ãÿ’˜¬Î¥Ê∑≈‘⁄Buffer1÷–
 245   2              FPM10A_Receive_Data(12);               
 246   2              FPM10A_Cmd_Search_Finger();                                //À—À˜»´≤ø”√ªß100√∂
 247   2              FPM10A_Receive_Data(16);
 248   2              if(FPM10A_RECEICE_BUFFER[9] == 0) //»Áπ˚À—À˜µΩ”–œ‡”¶µƒ÷∏Œ∆  
 249   2              {
 250   3                chen=0;         //ø™À¯µ∆¡¡
 251   3                        timer1=5;      //∂Êª˙◊™∂Øø™À¯ 
 252   3                        count=0;      
 253   3                delay1ms(2500);//—”≥Ÿ5s
 254   3                        timer1=27;     //∂Êª˙πÈŒª
 255   3                        count=0;
 256   3                        chen=1;
 257   3              }
 258   2              else
 259   2              {
 260   3                       shi=0;
 261   3                       delay1s();
 262   3                       shi=1;
 263   3               delay100ms(); //—”≥Ÿ100ms,Ã¯≥ˆ
 264   3              }
 265   2        }
 266   1      }
 267          
 268          
 269          /**********∂¡»°∫ÏÕ‚*********/
 270          void ReadIr() interrupt 0
 271          {
 272   1              u8 j,k;
 273   1              u16 err;
 274   1              Time=0;
 275   1              timer1=27;      //∂Êª˙πÈŒª
 276   1              count=0;                                 
 277   1              delay_Ir(700);  //7ms
 278   1              if(IRIN==0)             //»∑»œ «∑Ò’ÊµƒΩ” ’µΩ’˝»∑µƒ–≈∫≈
 279   1              {        
 280   2                      err=1000;                               //1000*10us=10ms,≥¨π˝Àµ√˜Ω” ’µΩ¥ÌŒÛµƒ–≈∫≈
 281   2                      /*µ±¡Ω∏ˆÃıº˛∂ºŒ™’Ê «—≠ª∑£¨»Áπ˚”–“ª∏ˆÃıº˛Œ™ºŸµƒ ±∫ÚÃ¯≥ˆ—≠ª∑£¨√‚µ√≥Ã–Ú≥ˆ¥Ìµƒ ±
 282   2                      ∫Ó£¨≥Ã–ÚÀ¿‘⁄’‚¿Ô*/      
 283   2                      while((IRIN==0)&&(err>0))       //µ»¥˝«∞√Ê9msµƒµÕµÁ∆Ωπ˝»•               
 284   2                      {                       
 285   3                              delay_Ir(1);
 286   3                              err--;
 287   3                      } 
 288   2                      if(IRIN==1)                     //»Áπ˚’˝»∑µ»µΩ9msµÕµÁ∆Ω
 289   2                      {
 290   3                              err=500;
 291   3                              while((IRIN==1)&&(err>0))                //µ»¥˝4.5msµƒ∆ º∏ﬂµÁ∆Ωπ˝»•
 292   3                              {
 293   4                                      delay_Ir(1);
 294   4                                      err--;
 295   4                              }
 296   3                              for(k=0;k<4;k++)                //π≤”–4◊È ˝æ›
 297   3                              {                               
 298   4                                      for(j=0;j<8;j++)        //Ω” ’“ª◊È ˝æ›
 299   4                                      {
 300   5                                              err=60;         
 301   5                                              while((IRIN==0)&&(err>0))//µ»¥˝–≈∫≈«∞√Êµƒ560usµÕµÁ∆Ωπ˝»•
C51 COMPILER V9.01   MAIN                                                                  04/24/2021 22:29:49 PAGE 6   

 302   5                                              {
 303   6                                                      delay_Ir(1);
 304   6                                                      err--;
 305   6                                              }
 306   5                                              err=500;
 307   5                                              while((IRIN==1)&&(err>0))        //º∆À„∏ﬂµÁ∆Ωµƒ ±º‰≥§∂»°£
 308   5                                              {
 309   6                                                      delay_Ir(10);    //0.1ms
 310   6                                                      Time++;
 311   6                                                      err--;
 312   6                                                      if(Time>30)
 313   6                                                      {
 314   7                                                              return;
 315   7                                                      }
 316   6                                              }
 317   5                                              IrValue[k]>>=1;  //k±Ì æµ⁄º∏◊È ˝æ›
 318   5                                              if(Time>=8)                     //»Áπ˚∏ﬂµÁ∆Ω≥ˆœ÷¥Û”⁄565us£¨ƒ«√¥ «1
 319   5                                              {
 320   6                                                      IrValue[k]|=0x80;
 321   6                                              }
 322   5                                              Time=0;         //”√ÕÍ ±º‰“™÷ÿ–¬∏≥÷µ                                                    
 323   5                                      }
 324   4                              }
 325   3                      }
 326   2                      //∑¥¬Î»°∑¥∫Û”Î‘≠¬Îœ‡Õ¨‘ÚÀµ√˜–≈∫≈Ω” ‹’˝»∑
 327   2                      if(IrValue[2]!=~IrValue[3])
 328   2                      {       
 329   3                              return;
 330   3                      }
 331   2                      else{
 332   3                              Irfet = 1;      //∫ÏÕ‚◊¥Ã¨ 1 Œ™’Ê
 333   3                              Irfet_led = 0;  //∫ÏÕ‚◊¥Ã¨µ∆µ∆ø™
 334   3                              delay500ms();
 335   3                              //∂Êª˙πÈŒª
 336   3                              timer1=27;              
 337   3                              count=0;
 338   3                      }
 339   2              }                       
 340   1      }
 341          
 342          
 343          
 344          //////////////////////////////////////////////
 345          //               ÷˜≥Ã–Ú                     //
 346          //////////////////////////////////////////////
 347          void main()         
 348          {
 349   1      delay500ms();//µ•∆¨ª˙…œµÁ,µ»¥˝1sŒ»∂®
 350   1      Uart_Init();   //≥ı ºªØ¥Æø⁄
 351   1      Timer0_Init(); //∂Êª˙≥ı ºªØ
 352   1      IrInit();       //∫ÏÕ‚≥ı ºªØ
 353   1      Irfet_led=1;    //∫ÏÕ‚µ∆
 354   1      led=1;
 355   1      chen=1;
 356   1      shi=1;
 357   1      GND=1;
 358   1      timer1=27;      //∂Êª˙πÈŒª
 359   1      count=0;
 360   1      PWM=1;
 361   1      pressed=0;
 362   1      Irfet=0;        //∫ÏÕ‚Ω” ’◊¥Ã¨÷√0
 363   1      led=0;           //π§◊˜÷∏ æµ∆¡¡,Ã·–—œµÕ≥“—æ≠ÕÍ≥…≥ı ºªØ  (≤‚ ‘Œ™0)
C51 COMPILER V9.01   MAIN                                                                  04/24/2021 22:29:49 PAGE 7   

 364   1      
 365   1              while(1)
 366   1              {
 367   2                      if(pressed==1)         //÷∏Œ∆ƒ£øÈ «±ª∞¥œ¬? ∞¥œ¬Œ™1 ∑Ò‘ÚŒ™0
 368   2                      {
 369   3                              Uart_Init();    //÷∏Œ∆≥ı ºªØ¥Æø⁄        
 370   3                                              timer1=27;              //∂Êª˙πÈŒª
 371   3                                              count=0;
 372   3                              delay500ms();//—”≥Ÿ0.5s//µ»¥˝SOC≥ı ºªØÕÍ≥…
 373   3                              Uart_Init();    //÷∏Œ∆≥ı ºªØ¥Æø⁄
 374   3                                              timer1=27;
 375   3                                              count=0;
 376   3                              FPM10A_Find_Fingerprint(); //≤È’“,∂‘±»÷∏Œ∆
 377   3                      }
 378   2      
 379   2                                      else if(Irfet==1){
 380   3                                              Irfet=0;                //∫ÏÕ‚–≈∫≈÷ÿ÷√
 381   3                                              chen=0;         //ø™À¯µ∆¡¡
 382   3                                              timer1=5;      //∂Êª˙◊™∂Øø™À¯ 
 383   3                                              count=0;        
 384   3                                          delay1ms(2500);//—”≥Ÿ5s
 385   3                                              timer1=27;         //∂Êª˙πÈŒª
 386   3                                              count=0;
 387   3                                              chen=1;
 388   3                                              Irfet_led = 1;  //∫ÏÕ‚µ∆√
 389   3                                              }
 390   2                                      else{
 391   3                              delay100ms();         //÷∏Œ∆ƒ£øÈ√ª±ª∞¥œ¬ —”≥Ÿ100ms               
 392   3                                              }
 393   2                              }
 394   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    765    ----
   CONSTANT SIZE    =     30    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     43       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
